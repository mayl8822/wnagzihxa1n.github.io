---
layout: post
title:  "大土豆安全笔记 2021.01.15 您已本分"
date:   2021-01-15 18:00:00 +520
categories: Security_Daily
---

先庆祝一下，写了两年公众号，这周关注破四百了，感谢四百零八位读者朋友们的支持，我再努把力，咱们过年前上五百

B站还真是一个神奇的网站，啥都能搜到，不过讲的并不是Mach Port很相关的

![IMAGE](/assets/resources/2E2BE9F76423A919F796CBBF9497E598.jpg)

周二发了一篇《[CVE-2020-27950 iOS内核信息泄露](https://mp.weixin.qq.com/s/H3x6mYuXcVge-EKn0gCrmw)》，这是近期我一直在学习的漏洞，主要是在Mach Message使用过程中，消息尾部的数据处理没有做好逻辑控制，导致一个字段可以绕过初始化，进而泄露出内核的数据

因为我是刚开始学习，所以有很多基础概念并不清楚，比如Mach Message是什么，Mach Port是什么，还有消息尾trailer，也是在翻了很多纸质资料再结合源码阅读才理解的，关于我看的资料文章里都有记录，包括纸质书籍对应的章节，也都有明确标识

读源码确实可以直观的学到很多，比如用户态数据是如何一层层走到内核态的，XNU的Trap机制，参数命名习惯等等，而且还可以顺带思考下这个漏洞路径周边是否有其它的问题

我还没有研究的很深入，比如Mach Port还要等待接下来仔细学习

本周在看的是玄武实验室发的一篇使用XPC机制提权的漏洞，这样的逻辑漏洞一直是我最喜欢的
- https://xlab.tencent.com/en/2021/01/11/cve-2020-9971-abusing-xpc-service-to-elevate-privilege/

PJ0的saelo之前分享的launchd漏洞以及2018 pwn2own的利用
- https://saelo.github.io/presentations/bits_of_launchd.pdf

这两个漏洞我会写比较详细的分析，从XPC开发层面使用，到launchd机制内部实现，在这两部分知识的基础上，再来分析两个漏洞

发现一个很有意思的项目，教大家怎么玩macOS驱动漏洞挖掘利用的，不过作者目前只写了一点，希望别鸽，挺期待的
- https://fuzzing.science/vulnerable-kext/about/index.html

这两天刷屏了一个病毒《[紧急通知：incaseformat病毒可清空硬盘](https://mp.weixin.qq.com/s/J3qblkEvGk-JXFKoIXTVPQ)》，这个病毒属于十多年前的老病毒，多家杀软都支持查杀，大家任选一个即可，这个病毒没啥特别的水平

关于病毒想给大家科普些概念：病毒本质上也是一个软件，背后也是代码

举个安卓病毒例子，我手机上有一款短信软件，有权限发送，接收，删除，编辑等权限，常规来看这种行为是没有问题的，那如果这个软件可以接收服务器的指令去做对应的行为呢？

比如服务器下发一个A指令，这个软件执行代码把短信打包发送回服务器，服务器下发B指令，这个软件就删除所有短信

**所有的行为，都是安卓系统本身所允许的操作**

高级的病毒，会使用漏洞技术，这些我们暂时不讨论

熊猫正正发了一篇对此事的看法《[对incaseformat蠕虫事件一些思考](https://mp.weixin.qq.com/s/5b7dr_k0gQdWnXPDN9Gxcg)》

我以前也是搞APT病毒分析的，我可以理解其中一些观点，现在大家都喜欢吹各种新概念，各种人工智能，机器学习，我也自己跟着学过一些，但毕竟体系庞大而我又很菜，没学会

又到了每周的吃瓜时间，pdd最近很火啊，火出圈了都

![IMAGE](/assets/resources/6A75CE1D9F7688B7BBA4886B69293F04.jpg)

远程删照片事件喜提热搜，这事我从技术角度讲几种可行方案

合理合法不犯罪的第一种：该用户用的是Vivo手机，Vivo是定制的Android系统，Android系统应用使用的是权限申请机制，举个例子，比如某个应用它某个功能需要读写相册，那么它就会申请读写相册的权限，并且需要用户手动点击弹窗的确认按钮，保证用户是知道且同意这个应用申请了读写相册的权限，那么在手机这一侧，pdd已经拥有了读写相册的权限，客户端再跟服务端建立一个指令下发通道，然后就可以跟跟病毒一样下发指令做删除照片的操作了

不合理不合法且犯罪的第二种：使用漏洞

如果是搁平常，我第一反应就是第二种不可能，因为国内Android手机系统版本太多了，首先厂商不同，厂商手机型号不同，还有那些十八线乱七八糟的杂牌，漏洞利用又是比较精细的活，一个字节偏移错了手机都要崩

但pdd现在这情况，我还真不敢说第二种没有可能，pdd的下沉用户到底有多下沉，有多少群体使用的手机系统根本就已经不维护更新了，其它不说，Sqlite，WebView，细思极恐

大牛蛙发的朋友圈，看来脉脉上爆料的拒绝黑客攻击是真的

![IMAGE](/assets/resources/AB7A39D6FA52C93725EFF5FB19ABB05C.jpg)

拼多多的安全大佬发的回忆录，我一直吐槽数字总是搬工位，看来垃圾行政管理哪哪都有，之前有一次搬工位，刚搬了一个月都不到，然后有一个其它部门的HR过来对着我们组的工位说她们要坐这里，我TM
- https://www.leadroyal.cn/?p=1228#more-1228

本来要收摊了，结果发现一封邮件，我现在是真的不敢去

![IMAGE](/assets/resources/5E3BA5D11F9FCF26E14A7451668952C8.jpg)
